<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Unconfined.isDispatchNeeded - kotlinx-coroutines-core</title>
  <meta name="description" content="Library support for kotlin coroutines">
  <link rel="stylesheet" href="/kotlinx.coroutines/assets/main.css">
  <link rel="canonical" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.experimental/-unconfined/is-dispatch-needed.html">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="/kotlinx.coroutines/assets/js/api.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-47631155-3', 'auto');
    ga('send', 'pageview');
  </script>
</head>

  <body>
    <header class="site-header" role="banner">
  <div class="wrapper">
    <a class="site-title" href="/kotlinx.coroutines/">kotlinx.coroutines</a>
  </div>
</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="api-docs-breadcrumbs"><a href="../../index.html">kotlinx-coroutines-core</a> / <a href="../index.html">kotlinx.coroutines.experimental</a> / <a href="index.html">Unconfined</a> / <a href="./is-dispatch-needed.html">isDispatchNeeded</a></div>

<h1 id="isdispatchneeded">isDispatchNeeded</h1>

<div class="signature"><code><span class="keyword">fun </span><span class="identifier">isDispatchNeeded</span><span class="symbol">(</span><span class="parameterName" id="kotlinx.coroutines.experimental.Unconfined$isDispatchNeeded(kotlin.coroutines.experimental.CoroutineContext)/context">context</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.coroutines.experimental/-coroutine-context/index.html"><span class="identifier">CoroutineContext</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html"><span class="identifier">Boolean</span></a></code></div>

<p>Overrides <a href="../-coroutine-dispatcher/is-dispatch-needed.html">CoroutineDispatcher.isDispatchNeeded</a></p>

<p>Returns <code>true</code> if execution shall be dispatched onto another thread.
The default behaviour for most dispatchers is to return <code>true</code>.</p>

<p>UI dispatchers <em>should not</em> override <code>isDispatchNeeded</code>, but leave a default implementation that
returns <code>true</code>. To understand the rationale beyond this recommendation, consider the following code:</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">asyncUpdateUI</span><span class="p">()</span> <span class="p">=</span> <span class="n">async</span><span class="p">(</span><span class="n">MainThread</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something here that updates something in UI
</span><span class="p">}</span>
</code></pre>
</div>

<p>When you invoke <code>asyncUpdateUI</code> in some background thread, it immediately continues to the next
line, while UI update happens asynchronously in the UI thread. However, if you invoke
it in the UI thread itself, it updates UI <em>synchronously</em> if your <code>isDispatchNeeded</code> is
overridden with a thread check. Checking if we are already in the UI thread seems more
efficient (and it might indeed save a few CPU cycles), but this subtle and context-sensitive
difference in behavior makes the resulting async code harder to debug.</p>

<p>Basically, the choice here is between “JS-style” asynchronous approach (async actions
are always postponed to be executed later in the even dispatch thread) and “C#-style” approach
(async actions are executed in the invoker thread until the first suspension point).
While, C# approach seems to be more efficient, it ends up with recommendations like
“use <code>yield</code> if you need to ….”. This is error-prone. JS-style approach is more consistent
and does not require programmers to think about whether they need to yield or not.</p>

<p>However, coroutine builders like <a href="../launch.html">launch</a> and <a href="../async.html">async</a> accept an optional <a href="../-coroutine-start/index.html">CoroutineStart</a>
parameter that allows one to optionally choose C#-style <a href="../-coroutine-start/-u-n-d-i-s-p-a-t-c-h-e-d.html">CoroutineStart.UNDISPATCHED</a> behaviour
whenever it is needed for efficiency.</p>


      </div>
    </main>
    <footer class="site-footer">
  <!-- empty -->
</footer>

  </body>
</html>

