<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>shareIn</title>
</head><body><link href="../../../images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "../../";</script><script type="text/javascript" src="../../scripts/sourceset_dependencies.js" async></script><link href="../../styles/style.css" rel="Stylesheet"><link href="../../styles/logo-styles.css" rel="Stylesheet"><link href="../../styles/jetbrains-mono.css" rel="Stylesheet"><link href="../../styles/main.css" rel="Stylesheet"><script type="text/javascript" src="../../scripts/clipboard.js" async></script><script type="text/javascript" src="../../scripts/navigation-loader.js" async></script><script type="text/javascript" src="../../scripts/platform-content-handler.js" async></script><script type="text/javascript" src="../../scripts/main.js" async></script>
  
    <div id="container">
      <div id="leftColumn"><a href="../../index.html">
            <div id="logo"></div>
          </a>
        <div id="paneSearch"></div>
        <div id="sideMenu"></div>
      </div>
      <div id="main">
        <script type="text/javascript" src="../../scripts/main.js"></script><div id="leftToggler"><span class="icon-toggler"></span></div>

        <div class="main-content" id="content" pageids="kotlinx-coroutines-core::kotlinx.coroutines.flow//shareIn/kotlinx.coroutines.flow.Flow[TypeParam(bounds=[kotlin.Any?])]#kotlinx.coroutines.CoroutineScope#kotlinx.coroutines.flow.SharingStarted#kotlin.Int/PointingToDeclaration//1975948010">
          <div class="navigation-wrapper" id="navigation-wrapper">
            <div class="breadcrumbs"><a href="../index.html">kotlinx-coroutines-core</a>/<a href="index.html">kotlinx.coroutines.flow</a>/<a href="share-in.html">shareIn</a></div>
            <div class="pull-right d-flex">
              <div class="filter-section" id="filter-section"><button class="platform-tag platform-selector common-like" data-active="" data-filter=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain">common</button></div>
              <div id="searchBar"></div>
            </div>
          </div>
          <div class="cover ">
            <h1 class="cover"><span>share</span><wbr><span>In</span></h1>
          </div>
<div class="divergent-group" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="symbol monospace">fun &lt;<a href="share-in.html">T</a>&gt; <a href="-flow/index.html">Flow</a>&lt;<a href="share-in.html">T</a>&gt;.<a href="share-in.html">shareIn</a>(scope: <a href="../kotlinx.coroutines/-coroutine-scope/index.html">CoroutineScope</a>, started: <a href="-sharing-started/index.html">SharingStarted</a>, replay: <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html">Int</a> = 0): <a href="-shared-flow/index.html">SharedFlow</a>&lt;<a href="share-in.html">T</a>&gt;<span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<p class="paragraph">Converts a cold<a href="-flow/index.html">Flow</a> into a hot<a href="-shared-flow/index.html">SharedFlow</a> that is started in the given coroutine <a href="share-in.html">scope</a>, sharing emissions from a single running instance of the upstream flow with multiple downstream subscribers, and replaying a specified number of <a href="share-in.html">replay</a> values to new subscribers. See the <a href="-shared-flow/index.html">SharedFlow</a> documentation for the general concepts of shared flows.</p><p class="paragraph">The starting of the sharing coroutine is controlled by the <a href="share-in.html">started</a> parameter. The following options are supported.</p><ul><li><p class="paragraph"><a href="-sharing-started/-companion/-eagerly.html">Eagerly</a> &amp;mdash; the upstream flow is started even before the first subscriber appears. Note that in this case all values emitted by the upstream beyond the most recent values as specified by <a href="share-in.html">replay</a> parameter will be immediately discarded.</p></li><li><p class="paragraph"><a href="-sharing-started/-companion/-lazily.html">Lazily</a> &amp;mdash; starts the upstream flow after the first subscriber appears, which guarantees that this first subscriber gets all the emitted values, while subsequent subscribers are only guaranteed to get the most recent <a href="share-in.html">replay</a> values. The upstream flow continues to be active even when all subscribers disappear, but only the most recent <a href="share-in.html">replay</a> values are cached without subscribers.</p></li><li><p class="paragraph"><a href="-sharing-started/-companion/-while-subscribed.html">WhileSubscribed()</a> &amp;mdash; starts the upstream flow when the first subscriber appears, immediately stops when the last subscriber disappears, keeping the replay cache forever. It has additional optional configuration parameters as explained in its documentation.</p></li><li><p class="paragraph">A custom strategy can be supplied by implementing the <a href="-sharing-started/index.html">SharingStarted</a> interface.</p></li></ul><p class="paragraph">The <code>shareIn</code> operator is useful in situations when there is a cold flow that is expensive to create and/or to maintain, but there are multiple subscribers that need to collect its values. For example, consider a flow of messages coming from a backend over the expensive network connection, taking a lot of time to establish. Conceptually, it might be implemented like this:</p><div class="sample-container"><code class="" theme="idea"><pre>val backendMessages: Flow&lt;Message&gt; = flow {<br>    connectToBackend() // takes a lot of time<br>    try {<br>      while (true) {<br>          emit(receiveMessageFromBackend())<br>      }<br>    } finally {<br>        disconnectFromBackend()<br>    }<br>}</pre></code></div><p class="paragraph">If this flow is directly used in the application, then every time it is collected a fresh connection is established, and it will take a while before messages start flowing. However, we can share a single connection and establish it eagerly like this:</p><div class="sample-container"><code class="" theme="idea"><pre>val messages: SharedFlow&lt;Message&gt; = backendMessages.shareIn(scope, SharingStarted.Eagerly)</pre></code></div><p class="paragraph">Now a single connection is shared between all collectors from <code>messages</code>, and there is a chance that the connection is already established by the time it is needed.</p><h3 class=""> Upstream completion and error handling</h3><p class="paragraph">Normal completion of the upstream flow has no effect on subscribers, and the sharing coroutine continues to run. If a strategy like <a href="-sharing-started/-companion/-while-subscribed.html">SharingStarted.WhileSubscribed</a> is used, then the upstream can get restarted again. If a special action on upstream completion is needed, then an <a href="on-completion.html">onCompletion</a> operator can be used before the <code>shareIn</code> operator to emit a special value in this case, like this:</p><div class="sample-container"><code class="" theme="idea"><pre>backendMessages<br>    .onCompletion { cause -&gt; if (cause == null) emit(UpstreamHasCompletedMessage) }<br>    .shareIn(scope, SharingStarted.Eagerly)</pre></code></div><p class="paragraph">Any exception in the upstream flow terminates the sharing coroutine without affecting any of the subscribers, and will be handled by the <a href="share-in.html">scope</a> in which the sharing coroutine is launched. Custom exception handling can be configured by using the <a href="catch.html">catch</a> or <a href="retry.html">retry</a> operators before the <code>shareIn</code> operator. For example, to retry connection on any <code>IOException</code> with 1 second delay between attempts, use:</p><div class="sample-container"><code class="" theme="idea"><pre>val messages = backendMessages<br>    .retry { e -&gt;<br>        val shallRetry = e is IOException // other exception are bugs - handle them<br>        if (shallRetry) delay(1000)<br>        shallRetry<br>    }<br>    .shareIn(scope, SharingStarted.Eagerly)</pre></code></div><h3 class=""> Initial value</h3><p class="paragraph">When a special initial value is needed to signal to subscribers that the upstream is still loading the data, use the <a href="on-start.html">onStart</a> operator on the upstream flow. For example:</p><div class="sample-container"><code class="" theme="idea"><pre>backendMessages<br>    .onStart { emit(UpstreamIsStartingMessage) }<br>    .shareIn(scope, SharingStarted.Eagerly, 1) // replay one most recent message</pre></code></div><h3 class=""> Buffering and conflation</h3><p class="paragraph">The <code>shareIn</code> operator runs the upstream flow in a separate coroutine, and buffers emissions from upstream as explained in the <a href="buffer.html">buffer</a> operator's description, using a buffer of <a href="share-in.html">replay</a> size or the default (whichever is larger). This default buffering can be overridden with an explicit buffer configuration by preceding the <code>shareIn</code> call with <a href="buffer.html">buffer</a> or <a href="conflate.html">conflate</a>, for example:</p><ul><li><p class="paragraph"><code>buffer(0).shareIn(scope, started, 0)</code> &amp;mdash; overrides the default buffer size and creates a <a href="-shared-flow/index.html">SharedFlow</a> without a buffer. Effectively, it configures sequential processing between the upstream emitter and subscribers, as the emitter is suspended until all subscribers process the value. Note, that the value is still immediately discarded when there are no subscribers.</p></li><li><p class="paragraph"><code>buffer(b).shareIn(scope, started, r)</code> &amp;mdash; creates a <a href="-shared-flow/index.html">SharedFlow</a> with <code>replay = r</code> and <code>extraBufferCapacity = b</code>.</p></li><li><p class="paragraph"><code>conflate().shareIn(scope, started, r)</code> &amp;mdash; creates a <a href="-shared-flow/index.html">SharedFlow</a> with <code>replay = r</code>, <code>onBufferOverflow = DROP_OLDEST</code>, and <code>extraBufferCapacity = 1</code> when <code>replay == 0</code> to support this strategy.</p></li></ul><h3 class=""> Operator fusion</h3><p class="paragraph">Application of <a href="flow-on.html">flowOn</a>, <a href="buffer.html">buffer</a> with <a href="../kotlinx.coroutines.channels/-channel/-factory/-r-e-n-d-e-z-v-o-u-s.html">RENDEZVOUS</a> capacity, or <a href="cancellable.html">cancellable</a> operators to the resulting shared flow has no effect.</p><h3 class=""> Exceptions</h3><p class="paragraph">This function throws <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-illegal-argument-exception/index.html">IllegalArgumentException</a> on unsupported values of parameters or combinations thereof.</p><h2 class="">Parameters</h2><div data-togglable="Parameters"><div class="platform-hinted WithExtraAttributes" data-platform-hinted="data-platform-hinted" data-togglable="Parameters"><div class="content sourceset-depenent-content" data-active="" data-togglable=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div data-togglable="Parameters"><div class="table" data-togglable="Parameters"><div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="main-subrow keyValue WithExtraAttributes"><div class=""><span class="inline-flex">scope</span></div><div><div class="title"><div data-togglable="Parameters"><p class="paragraph">the coroutine scope in which sharing is started.</p></div></div></div></div></div><div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="main-subrow keyValue WithExtraAttributes"><div class=""><span class="inline-flex">started</span></div><div><div class="title"><div data-togglable="Parameters"><p class="paragraph">the strategy that controls when sharing is started and stopped.</p></div></div></div></div></div><div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="main-subrow keyValue WithExtraAttributes"><div class=""><span class="inline-flex">replay</span></div><div><div class="title"><div data-togglable="Parameters"><p class="paragraph">the number of values replayed to new subscribers (cannot be negative, defaults to zero).</p></div></div></div></div></div></div></div></div></div></div></div>
          <h2 class="">Sources</h2>
          <div class="table" data-togglable="Sources"><a data-name="593296918%2FSource%2F1975948010" anchor-label="https://github.com/kotlin/kotlinx.coroutines/tree/master/kotlinx-coroutines-core/common/src/flow/operators/Share.kt#L18" id="593296918%2FSource%2F1975948010" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"></a>
            <div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain">
              <div class="main-subrow keyValue ">
                <div class=""><span class="inline-flex"><a href="https://github.com/kotlin/kotlinx.coroutines/tree/master/kotlinx-coroutines-core/common/src/flow/operators/Share.kt#L18">common source</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="593296918%2FSource%2F1975948010"></span>
                      <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                    </span></span></div>
                <div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="footer"><span class="go-to-top-icon"><a href="#content"></a></span><span>© 2021 Copyright</span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span></div>
      </div>
    </div>
  
</body></html>


