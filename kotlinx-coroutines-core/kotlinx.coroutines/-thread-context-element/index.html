<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ThreadContextElement - kotlinx-coroutines-core</title>
  <meta name="description" content="Library support for kotlin coroutines">
  <link rel="stylesheet" href="/kotlinx.coroutines/assets/main.css">
  <link rel="canonical" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-thread-context-element/">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="/kotlinx.coroutines/assets/js/api.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-47631155-3', 'auto');
    ga('send', 'pageview');
  </script>
</head>

  <body>
    <header class="site-header" role="banner">
  <div class="wrapper">
    <a class="site-title" href="/kotlinx.coroutines/">kotlinx.coroutines</a>
  </div>
</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="api-docs-breadcrumbs"><a href="../../index.html">kotlinx-coroutines-core</a> / <a href="../index.html">kotlinx.coroutines</a> / <a href="./index.html">ThreadContextElement</a></div>

<h1 id="threadcontextelement">ThreadContextElement</h1>

<div class="signature"><code><span class="keyword">interface </span><span class="identifier">ThreadContextElement</span><span class="symbol">&lt;</span><span class="identifier">S</span><span class="symbol">&gt;</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.coroutines/-coroutine-context/-element/index.html"><span class="identifier">Element</span></a></code> <a href="https://github.com/kotlin/kotlinx.coroutines/tree/master/kotlinx-coroutines-core/jvm/src/ThreadContextElement.kt#L52">(source)</a></div>

<p><strong>Platform and version requirements:</strong> JVM</p>

<p>Defines elements in <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.coroutines/-coroutine-context/index.html">CoroutineContext</a> that are installed into thread context
every time the coroutine with this element in the context is resumed on a thread.</p>

<p>Implementations of this interface define a type <a href="index.html#S">S</a> of the thread-local state that they need to store on
resume of a coroutine and restore later on suspend. The infrastructure provides the corresponding storage.</p>

<p>Example usage looks like this:</p>

<pre>// Appends "name" of a coroutine to a current thread name when coroutine is executed
class CoroutineName(val name: String) : ThreadContextElement&lt;String&gt; {
    // declare companion object for a key of this element in coroutine context
    companion object Key : CoroutineContext.Key&lt;CoroutineName&gt;

    // provide the key of the corresponding context element
    override val key: CoroutineContext.Key&lt;CoroutineName&gt;
        get() = Key

    // this is invoked before coroutine is resumed on current thread
    override fun updateThreadContext(context: CoroutineContext): String {
        val previousName = Thread.currentThread().name
        Thread.currentThread().name = "$previousName # $name"
        return previousName
    }

    // this is invoked after coroutine has suspended on current thread
    override fun restoreThreadContext(context: CoroutineContext, oldState: String) {
        Thread.currentThread().name = oldState
    }
}

// Usage
launch(Dispatchers.Main + CoroutineName("Progress bar coroutine")) { ... }
</pre>

<p>Every time this coroutine is resumed on a thread, UI thread name is updated to
“UI thread original name # Progress bar coroutine” and the thread name is restored to the original one when
this coroutine suspends.</p>

<p>To use <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/ThreadLocal.html">ThreadLocal</a> variable within the coroutine use <a href="../java.lang.-thread-local/as-context-element.html">ThreadLocal.asContextElement</a> function.</p>

<h3 id="functions">Functions</h3>

<table class="api-docs-table">
<tbody>
<tr>
<td>

        <p><a href="restore-thread-context.html">restoreThreadContext</a></p>

      </td>
<td>
        <div class="signature"><code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="identifier">restoreThreadContext</span><span class="symbol">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="parameterName" id="kotlinx.coroutines.ThreadContextElement$restoreThreadContext(kotlin.coroutines.CoroutineContext, kotlinx.coroutines.ThreadContextElement.S)/context">context</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.coroutines/-coroutine-context/index.html"><span class="identifier">CoroutineContext</span></a><span class="symbol">, </span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="parameterName" id="kotlinx.coroutines.ThreadContextElement$restoreThreadContext(kotlin.coroutines.CoroutineContext, kotlinx.coroutines.ThreadContextElement.S)/oldState">oldState</span><span class="symbol">:</span>&nbsp;<a href="index.html#S"><span class="identifier">S</span></a><br /><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a></code></div>

        <p>Restores context of the current thread.
This function is invoked after the coroutine in the specified <a href="restore-thread-context.html#kotlinx.coroutines.ThreadContextElement$restoreThreadContext(kotlin.coroutines.CoroutineContext, kotlinx.coroutines.ThreadContextElement.S)/context">context</a> is suspended in the current thread
if <a href="update-thread-context.html">updateThreadContext</a> was previously invoked on resume of this coroutine.
The value of <a href="restore-thread-context.html#kotlinx.coroutines.ThreadContextElement$restoreThreadContext(kotlin.coroutines.CoroutineContext, kotlinx.coroutines.ThreadContextElement.S)/oldState">oldState</a> is the result of the previous invocation of <a href="update-thread-context.html">updateThreadContext</a> and it should
be restored in the thread-local state by this function.
This method should handle its own exceptions and do not rethrow it. Thrown exceptions will leave coroutine which
context is updated in an undefined state and may crash an application.</p>

      </td>
</tr>
<tr>
<td>

        <p><a href="update-thread-context.html">updateThreadContext</a></p>

      </td>
<td>
        <div class="signature"><code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="identifier">updateThreadContext</span><span class="symbol">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="parameterName" id="kotlinx.coroutines.ThreadContextElement$updateThreadContext(kotlin.coroutines.CoroutineContext)/context">context</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.coroutines/-coroutine-context/index.html"><span class="identifier">CoroutineContext</span></a><br /><span class="symbol">)</span><span class="symbol">: </span><a href="index.html#S"><span class="identifier">S</span></a></code></div>

        <p>Updates context of the current thread.
This function is invoked before the coroutine in the specified <a href="update-thread-context.html#kotlinx.coroutines.ThreadContextElement$updateThreadContext(kotlin.coroutines.CoroutineContext)/context">context</a> is resumed in the current thread
when the context of the coroutine this element.
The result of this function is the old value of the thread-local state that will be passed to <a href="restore-thread-context.html">restoreThreadContext</a>.
This method should handle its own exceptions and do not rethrow it. Thrown exceptions will leave coroutine which
context is updated in an undefined state and may crash an application.</p>

      </td>
</tr>
</tbody>
</table>

      </div>
    </main>
    <footer class="site-footer">
  <!-- empty -->
</footer>

  </body>
</html>

