<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>Channel</title>
</head><body><link href="../../../../../images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "../../../";</script><script type="text/javascript" src="../../../scripts/sourceset_dependencies.js" async></script><link href="../../../styles/style.css" rel="Stylesheet"><link href="../../../styles/logo-styles.css" rel="Stylesheet"><link href="../../../styles/jetbrains-mono.css" rel="Stylesheet"><link href="../../../styles/main.css" rel="Stylesheet"><script type="text/javascript" src="../../../scripts/clipboard.js" async></script><script type="text/javascript" src="../../../scripts/navigation-loader.js" async></script><script type="text/javascript" src="../../../scripts/platform-content-handler.js" async></script><script type="text/javascript" src="../../../scripts/main.js" async></script>
  
    <div id="container">
      <div id="leftColumn"><a href="../../../index.html">
            <div id="logo"></div>
          </a>
        <div id="paneSearch"></div>
        <div id="sideMenu"></div>
      </div>
      <div id="main">
        <script type="text/javascript" src="../../../scripts/main.js"></script><div id="leftToggler"><span class="icon-toggler"></span></div>

        <div class="main-content" id="content" pageids="kotlinx-coroutines-core::kotlinx.coroutines.channels/Channel///PointingToDeclaration//1975948010">
          <div class="navigation-wrapper" id="navigation-wrapper">
            <div class="breadcrumbs"><a href="../../index.html">kotlinx-coroutines-core</a>/<a href="../index.html">kotlinx.coroutines.channels</a>/<a href="index.html">Channel</a></div>
            <div class="pull-right d-flex">
              <div class="filter-section" id="filter-section"><button class="platform-tag platform-selector common-like" data-active="" data-filter=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain">common</button></div>
              <div id="searchBar"></div>
            </div>
          </div>
          <div class="cover ">
            <h1 class="cover"><span>Channel</span></h1>
            <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="symbol monospace">interface <a href="index.html">Channel</a>&lt;<a href="index.html">E</a>&gt; : <a href="../-send-channel/index.html">SendChannel</a>&lt;<a href="index.html">E</a>&gt; , <a href="../-receive-channel/index.html">ReceiveChannel</a>&lt;<a href="index.html">E</a>&gt; <span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Channel is a non-blocking primitive for communication between a sender (via <a href="../-send-channel/index.html">SendChannel</a>) and a receiver (via <a href="../-receive-channel/index.html">ReceiveChannel</a>). Conceptually, a channel is similar to Java's java.util.concurrent.BlockingQueue, but it has suspending operations instead of blocking ones and can be <a href="../-send-channel/close.html">closed</a>.</p><h3 class=""> Creating channels</h3><p class="paragraph">The <code>Channel(capacity)</code> factory function is used to create channels of different kinds depending on the value of the <code>capacity</code> integer:</p><ul><li><p class="paragraph">When <code>capacity</code> is 0 &amp;mdash; it creates a rendezvous channel. This channel does not have any buffer at all. An element is transferred from the sender to the receiver only when <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/send.html">send</a> and <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/receive.html">receive</a> invocations meet in time (rendezvous), so <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/send.html">send</a> suspends until another coroutine invokes <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/receive.html">receive</a>, and <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/receive.html">receive</a> suspends until another coroutine invokes <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/send.html">send</a>.</p></li><li><p class="paragraph">When <code>capacity</code> is <a href="-factory/-u-n-l-i-m-i-t-e-d.html">Channel.UNLIMITED</a> &amp;mdash; it creates a channel with effectively unlimited buffer. This channel has a linked-list buffer of unlimited capacity (limited only by available memory). <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/send.html">Sending</a> to this channel never suspends, and <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/try-send.html">trySend</a> always succeeds.</p></li><li><p class="paragraph">When <code>capacity</code> is <a href="-factory/-c-o-n-f-l-a-t-e-d.html">Channel.CONFLATED</a> &amp;mdash; it creates a conflated channel This channel buffers at most one element and conflates all subsequent <code>send</code> and <code>trySend</code> invocations, so that the receiver always gets the last element sent. Back-to-back sent elements are conflated &amp;mdash; only the last sent element is received, while previously sent elements are lost. <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/send.html">Sending</a> to this channel never suspends, and <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/try-send.html">trySend</a> always succeeds.</p></li><li><p class="paragraph">When <code>capacity</code> is positive but less than <a href="-factory/-u-n-l-i-m-i-t-e-d.html">UNLIMITED</a> &amp;mdash; it creates an array-based channel with the specified capacity. This channel has an array buffer of a fixed <code>capacity</code>. <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/send.html">Sending</a> suspends only when the buffer is full, and <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/receive.html">receiving</a> suspends only when the buffer is empty.</p></li></ul><p class="paragraph">Buffered channels can be configured with an additional <a href="../-buffer-overflow/index.html"><code>onBufferOverflow</code></a> parameter. It controls the behaviour of the channel's <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-channel/send.html">send</a> function on buffer overflow:</p><ul><li><p class="paragraph"><a href="../-buffer-overflow/-s-u-s-p-e-n-d/index.html">SUSPEND</a> &amp;mdash; the default, suspend <code>send</code> on buffer overflow until there is free space in the buffer.</p></li><li><p class="paragraph"><a href="../-buffer-overflow/-d-r-o-p_-o-l-d-e-s-t/index.html">DROP_OLDEST</a> &amp;mdash; do not suspend the <code>send</code>, add the latest value to the buffer, drop the oldest one from the buffer. A channel with <code>capacity = 1</code> and <code>onBufferOverflow = DROP_OLDEST</code> is a conflated channel.</p></li><li><p class="paragraph"><a href="../-buffer-overflow/-d-r-o-p_-l-a-t-e-s-t/index.html">DROP_LATEST</a> &amp;mdash; do not suspend the <code>send</code>, drop the value that is being sent, keep the buffer contents intact.</p></li></ul><p class="paragraph">A non-default <code>onBufferOverflow</code> implicitly creates a channel with at least one buffered element and is ignored for a channel with unlimited buffer. It cannot be specified for <code>capacity = CONFLATED</code>, which is a shortcut by itself.</p><h3 class=""> Prompt cancellation guarantee</h3><p class="paragraph">All suspending functions with channels provide prompt cancellation guarantee. If the job was cancelled while send or receive function was suspended, it will not resume successfully, but throws a <a href="../../kotlinx.coroutines/-cancellation-exception/index.html">CancellationException</a>. With a single-threaded <a href="../../kotlinx.coroutines/-coroutine-dispatcher/index.html">dispatcher</a> like <a href="../../kotlinx.coroutines/-dispatchers/-main.html">Dispatchers.Main</a> this gives a guarantee that if a piece code running in this thread cancels a <a href="../../kotlinx.coroutines/-job/index.html">Job</a>, then a coroutine running this job cannot resume successfully and continue to run, ensuring a prompt response to its cancellation.</p><div class="sample-container"><code class="" theme="idea"><pre><p class="paragraph">Prompt cancellation guarantee for channel operations was added since <code>kotlinx.coroutines</code> version <code>1.4.0</code> and had replaced a channel-specific atomic-cancellation that was not consistent with other suspending functions. The low-level mechanics of prompt cancellation are explained in <a href="../../kotlinx.coroutines/suspend-cancellable-coroutine.html">suspendCancellableCoroutine</a> function.</p></pre></code></div><h3 class=""> Undelivered elements</h3><p class="paragraph">As a result of a prompt cancellation guarantee, when a closeable resource (like open file or a handle to another native resource) is transferred via channel from one coroutine to another it can fail to be delivered and will be lost if either send or receive operations are cancelled in transit.</p><p class="paragraph">A <code>Channel()</code> constructor function has an <code>onUndeliveredElement</code> optional parameter. When <code>onUndeliveredElement</code> parameter is set, the corresponding function is called once for each element that was sent to the channel with the call to the <a href="../-send-channel/send.html">send</a> function but failed to be delivered, which can happen in the following cases:</p><ul><li><p class="paragraph">When <a href="../-send-channel/send.html">send</a> operation throws an exception because it was cancelled before it had a chance to actually send the element or because the channel was <a href="../-send-channel/close.html">closed</a> or <a href="../-receive-channel/cancel.html">cancelled</a>.</p></li><li><p class="paragraph">When <a href="../-receive-channel/receive.html">receive</a>, <a href="../../../kotlinx-coroutines-core/kotlinx.coroutines.channels/-receive-channel/receive-or-null.html">receiveOrNull</a>, or <a href="../-channel-iterator/has-next.html">hasNext</a> operation throws an exception when it had retrieved the element from the channel but was cancelled before the code following the receive call resumed.</p></li><li><p class="paragraph">The channel was <a href="../-receive-channel/cancel.html">cancelled</a>, in which case <code>onUndeliveredElement</code> is called on every remaining element in the channel's buffer.</p></li></ul><p class="paragraph">Note, that <code>onUndeliveredElement</code> function is called synchronously in an arbitrary context. It should be fast, non-blocking, and should not throw exceptions. Any exception thrown by <code>onUndeliveredElement</code> is wrapped into an internal runtime exception which is either rethrown from the caller method or handed off to the exception handler in the current context (see <a href="../../kotlinx.coroutines/-coroutine-exception-handler/index.html">CoroutineExceptionHandler</a>) when one is available.</p><p class="paragraph">A typical usage for <code>onDeliveredElement</code> is to close a resource that is being transferred via the channel. The following code pattern guarantees that opened resources are closed even if producer, consumer, and/or channel are cancelled. Resources are never lost.</p><div class="sample-container"><code class="" theme="idea"><pre>// Create the channel with onUndeliveredElement block that closes a resource<br>val channel = Channel&lt;Resource&gt;(capacity) { resource -&gt; resource.close() }<br><br>// Producer code<br>val resourceToSend = openResource()<br>channel.send(resourceToSend)<br><br>// Consumer code<br>val resourceReceived = channel.receive()<br>try {<br>    // work with received resource<br>} finally {<br>    resourceReceived.close()<br>}</pre></code></div><div class="sample-container"><code class="" theme="idea"><pre><p class="paragraph">Note, that if you do any kind of work in between <code>openResource()</code> and <code>channel.send(...)</code>, then you should ensure that resource gets closed in case this additional code fails.</p></pre></code></div></div></div>
          </div>
          <div class="tabbedcontent">
            <div class="tabs-section" tabs-section="tabs-section"><button class="section-tab" data-active="" data-togglable="Types">Types</button><button class="section-tab" data-togglable="Sources">Sources</button></div>
            <div class="tabs-section-body">
              <h2 class="">Types</h2>
              <div class="table" data-togglable="Types"><a data-name="-951096331%2FClasslikes%2F1975948010" anchor-label="Factory" id="-951096331%2FClasslikes%2F1975948010" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"></a>
                <div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-factory/index.html">Factory</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-951096331%2FClasslikes%2F1975948010"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="platform-tags ">
                        <div class="platform-tag common-like">common</div>
                      </div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="symbol monospace">object <a href="-factory/index.html">Factory</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="-951096331%2FClasslikes%2F1975948010" anchor-label="Factory" id="-951096331%2FClasslikes%2F1975948010" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"></a><div class="brief "><a data-name="-951096331%2FClasslikes%2F1975948010" anchor-label="Factory" id="-951096331%2FClasslikes%2F1975948010" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"></a>Constants for the channel factory function <code>Channel()</code>.</div></div>
</div>
                    </div>
                  </div>
                </div>
              </div>
              <h2 class="">Sources</h2>
              <div class="table" data-togglable="Sources"><a data-name="1579659633%2FSource%2F1975948010" anchor-label="https://github.com/kotlin/kotlinx.coroutines/tree/master/kotlinx-coroutines-core/common/src/channels/Channel.kt#L606" id="1579659633%2FSource%2F1975948010" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"></a>
                <div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="https://github.com/kotlin/kotlinx.coroutines/tree/master/kotlinx-coroutines-core/common/src/channels/Channel.kt#L606">common source</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1579659633%2FSource%2F1975948010"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="footer"><span class="go-to-top-icon"><a href="#content"></a></span><span>© 2021 Copyright</span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span></div>
      </div>
    </div>
  
</body></html>


